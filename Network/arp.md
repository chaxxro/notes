# ARP 协议

ARP 协议根据 IP 地址获取 MAC 地址

每台主机都有一个 ARP 高速缓存，存放了 IP 地址到硬件地址的映射，且映射经常动态更新

当本地没有 IP 地址的 MAC 地址时，便向局域网上广播一个 ARP 请求

ARP 解决的是同一局域网内 IP 与 MAC 地址的映射问题，当跨局域网时需要路由器转发 ARP 请求

## ARP 表

在网络拓扑中的每个节点或说主机上都维护有一张 ARP 表，它记录着主机的 IP 地址到 MAC 地址的映射关系

1. 主机 A 想发送数据包给通过交换机相连的处于同一网段内的另一台主机 B，此时主机 A 已经知道主机 B 的 IP 地址

2. 主机A首先会检查自己的 ARP 表，查看是否有主机 B 的 IP 地址与其 MAC 地址的对应关系，如果有则直接将主机 B 的 MAC 地址作为目的 MAC 地址封装到数据帧中，否则发送一个 ARP 请求信息，请求的目的 IP 地址是主机 B 的 IP 地址，目的 MAC 地址是 MAC 层的广播地址

3. 交换机接收到该广播帧之后，将此数据帧从非接收的所有端口发送出去

4. 同一网段中的所有节点都会接收到该 ARP 请求数据包，目的 IP 不匹配的节点会直接忽略该请求，而当主机 B 接收到此数据帧后，解析到 IP 地址与自己的 IP 地址一致，先将主机 A 的 IP 地址及其 MAC 地址的对应关系记录到自己的 ARP 表中，同时会发送一个 ARP 应答，应答数据包源 MAC 地址即主机 B 自身的 MAC 地址，该应答通过交换机转发至主机 A

5. 主机 A 在收到这个回应的数据帧之后，在自己的 ARP 表中记录主机 B 的 IP 地址和 MAC 地址的对应关系